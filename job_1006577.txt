Complete!
INFO[0093] Taking snapshot of full filesystem...        
INFO[0108] RUN git clone "https://gitlab-ci-token:${CI_JOB_TOKEN}@gitlab.core-services.leaseplan.systems/workloads/0072-wkl-lpbr-apps/mobile-app.git" 
INFO[0108] Cmd: /bin/sh                                 
INFO[0108] Args: [-c git clone "https://gitlab-ci-token:${CI_JOB_TOKEN}@gitlab.core-services.leaseplan.systems/workloads/0072-wkl-lpbr-apps/mobile-app.git"] 
INFO[0108] Running: [/bin/sh -c git clone "https://gitlab-ci-token:${CI_JOB_TOKEN}@gitlab.core-services.leaseplan.systems/workloads/0072-wkl-lpbr-apps/mobile-app.git"] 
Cloning into 'mobile-app'...
INFO[0108] Taking snapshot of full filesystem...        
INFO[0113] RUN cd "mobile-app"                          
INFO[0113] Cmd: /bin/sh                                 
INFO[0113] Args: [-c cd "mobile-app"]                   
INFO[0113] Running: [/bin/sh -c cd "mobile-app"]        
INFO[0113] Taking snapshot of full filesystem...        
INFO[0114] No files were changed, appending empty layer to config. No layer added to image. 
INFO[0114] RUN git checkout develop                     
INFO[0114] Cmd: /bin/sh                                 
INFO[0114] Args: [-c git checkout develop]              
INFO[0114] Running: [/bin/sh -c git checkout develop]   
error: pathspec 'develop' did not match any file(s) known to git
error building image: error building stage: failed to execute command: waiting for process to exit: exit status 1
Cleaning up project directory and file based variables
00:01
ERROR: Job failed: command terminated with exit code 1


WORKDIR /usr/src/app
COPY . .

RUN set -eux; \
  (apt-get update && apt-get install -y --no-install-recommends git ca-certificates) \
  || (yum -y install git ca-certificates) \
  || (microdnf -y install git ca-certificates) \
  || (apk add --no-cache git ca-certificates)


RUN git clone "https://gitlab-ci-token:${CI_JOB_TOKEN}@gitlab.core-services.leaseplan.systems/workloads/0072-wkl-lpbr-apps/mobile-app.git"
RUN cd "mobile-app"
RUN git checkout develop
RUN mvn clean install
RUN ls -la
RUN cd ..

ARG MAVEN_VERSION=3.9.4
ARG USER_HOME_DIR="/root"
ENV MAVEN_CONFIG "$USER_HOME_DIR/.m2"
ENTRYPOINT ["/usr/local/bin/mvn-entrypoint.sh"]

WORKDIR /usr/src/app
COPY . .


Complete!
INFO[0085] Taking snapshot of full filesystem...        
INFO[0100] RUN git clone "https://gitlab-ci-token:${CI_JOB_TOKEN}@gitlab.core-services.leaseplan.systems/workloads/0072-wkl-lpbr-apps/mobile-app.git" 
INFO[0100] Cmd: /bin/sh                                 
INFO[0100] Args: [-c git clone "https://gitlab-ci-token:${CI_JOB_TOKEN}@gitlab.core-services.leaseplan.systems/workloads/0072-wkl-lpbr-apps/mobile-app.git"] 
INFO[0100] Running: [/bin/sh -c git clone "https://gitlab-ci-token:${CI_JOB_TOKEN}@gitlab.core-services.leaseplan.systems/workloads/0072-wkl-lpbr-apps/mobile-app.git"] 
Cloning into 'mobile-app'...
remote: HTTP Basic: Access denied. The provided password or token is incorrect or your account has 2FA enabled and you must use a personal access token instead of a password. See https://gitlab.core-services.leaseplan.systems/help/topics/git/troubleshooting_git#error-on-git-fetch-http-basic-access-denied
fatal: Authentication failed for 'https://gitlab.core-services.leaseplan.systems/workloads/0072-wkl-lpbr-apps/mobile-app.git/'
error building image: error building stage: failed to execute command: waiting for process to exit: exit status 128
Cleaning up project directory and file based variables




WORKDIR /usr/src/app
COPY . .

RUN set -eux; \
  (apt-get update && apt-get install -y --no-install-recommends git ca-certificates) \
  || (yum -y install git ca-certificates) \
  || (microdnf -y install git ca-certificates) \
  || (apk add --no-cache git ca-certificates)


RUN git clone "https://gitlab-ci-token:${CI_JOB_TOKEN}@gitlab.core-services.leaseplan.systems/workloads/0072-wkl-lpbr-apps/mobile-app.git"
RUN git checkout develop
RUN cd "mobile-app"
RUN mvn clean install
RUN ls -la
RUN cd ..


include:
  - project: 'templates/gitlab-ci/pipelines'
    ref: master
    file: 'kaniko/login.yml'

workflow:
  rules:
    - when: always

stages:
  # - prepare
  - build
  - development
  - uat
  - production

variables:
  LZ_KANIKO_EXECUTOR_IMAGE: cr.core-services.leaseplan.systems/lz/lz-kaniko:master
  LZ_DOCKER_REGISTRY: https://cr.core-services.leaseplan.systems
  VAULT_AUTH_ROLE: workloads-0072-wkl-lpbr-apps
  ARTIFACTORY_ROLE_DOCKER: art-0072-write-docker-local-default
  KANIKO_EXTRA_ARGS: ""
  KANIKO_EXTRA_ARGS_BUILD: ""
  DOCKER_FILE: chatbot-agendamento/Dockerfile
  DOCKER_REGISTRY: cr.core-services.leaseplan.systems/0072
  DOCKER_IMAGE_NAME: chatbot-agendamento
  VERSION: 2.0.x8
  container: docker
  KUBERNETES_MEMORY_REQUEST: 1Gi
  KUBERNETES_MEMORY_LIMIT: 12Gi
  GITLAB_HOST: gitlab.core-services.leaseplan.systems
  GITLAB_USER: gitlab-ci-token

build:
  tags:
    - k8s-scalable
  stage: build
  image:  $LZ_KANIKO_EXECUTOR_IMAGE
  extends:
    - .kaniko-login
  script:
    - |
      /kaniko/executor \
        --context $CI_PROJECT_DIR \
        --dockerfile $CI_PROJECT_DIR/$DOCKER_FILE \
        --build-arg GITLAB_HOST="$GITLAB_HOST" \
        --build-arg GITLAB_USER="$GITLAB_USER" \
        --build-arg GITLAB_TOKEN="$CI_JOB_TOKEN" \
        --no-push
